rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Function to check if user is admin
    function isAdmin() {
      return request.auth.token.email == "beherajashobanta892@gmail.com" ||
             request.auth.token.email == "admin@example.com";
    }

    // ----------------------------
    // Contacts Collection
    // ----------------------------
    match /contacts/{docId} {
      // Admins can do everything on single docs
      allow get, update, delete: if isAdmin();
      
      // Admins can list the whole collection
      allow list: if isAdmin();

      // Any authenticated user can create a contact
      allow create: if request.auth != null;

      // A non-admin user can read/write their own document
      allow get, update, delete: if request.auth.uid == resource.data.uid;
      
      // A non-admin user can only list their own documents
      allow list: if request.auth.uid == request.query.filters.uid.string_value;
    }

    // ----------------------------
    // Reviews Collection
    // ----------------------------
    match /reviews/{docId} {
      allow create: if true; // anyone can submit
      allow read, update, delete: if isAdmin();
    }

    // ----------------------------
    // Default Rule
    // ----------------------------
    // Deny all other reads/writes by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
